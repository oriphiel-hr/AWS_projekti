# uslugar/backend/Dockerfile.prod
FROM node:20-bookworm-slim

WORKDIR /app

# 1) package*.json iz trenutnog konteksta (uslugar/backend)
COPY package*.json ./
RUN npm ci

# 2) kopiraj sav kod iz trenutnog konteksta
COPY . .

# 3) generiraj Prisma klijent (glibc), pa makni dev deps
RUN npx prisma generate --schema=prisma/schema.prisma \
 && npm prune --omit=dev

ENV NODE_ENV=production
CMD ["node", "server.js"]
