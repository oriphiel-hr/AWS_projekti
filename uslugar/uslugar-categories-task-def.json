{
  "memory": "1024",
  "cpu": "512",
  "executionRoleArn": "arn:aws:iam::666203386231:role/ecsTaskExecutionRole",
  "requiresCompatibilities": [
    "FARGATE"
  ],
  "family": "uslugar-with-categories-endpoint",
  "containerDefinitions": [
    {
      "environment": [
        {
          "name": "PORT",
          "value": "8080"
        },
        {
          "name": "JWT_SECRET",
          "value": "dev-super-secret"
        }
      ],
      "name": "uslugar",
      "secrets": [
        {
          "name": "DATABASE_URL",
          "valueFrom": "arn:aws:secretsmanager:eu-north-1:666203386231:secret:uslugar-db-connection-string"
        }
      ],
      "image": "666203386231.dkr.ecr.eu-north-1.amazonaws.com/uslugar:72331f9b839866642ad06c959bc194e4e9bf07fb",
      "portMappings": [
        {
          "containerPort": 8080,
          "protocol": "tcp"
        }
      ],
      "logConfiguration": {
        "logDriver": "awslogs",
        "options": {
          "awslogs-region": "eu-north-1",
          "awslogs-stream-prefix": "ecs",
          "awslogs-create-group": "true",
          "awslogs-group": "/ecs/uslugar"
        }
      },
      "essential": true
    },
    {
      "name": "nginx-proxy",
      "logConfiguration": {
        "logDriver": "awslogs",
        "options": {
          "awslogs-region": "eu-north-1",
          "awslogs-stream-prefix": "ecs",
          "awslogs-create-group": "true",
          "awslogs-group": "/ecs/uslugar"
        }
      },
      "image": "nginx:alpine",
      "portMappings": [
        {
          "containerPort": 80,
          "protocol": "tcp"
        }
      ],
      "command": [
        "sh",
        "-c",
        "echo 'server { listen 80; location / { proxy_pass http://localhost:8080; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; } }' > /etc/nginx/conf.d/default.conf && nginx -g 'daemon off;'"
      ],
      "essential": false
    }
  ],
  "networkMode": "awsvpc"
}
